<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Business Proposal PDF Generator</title>

  <!-- libs -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root { --page-w: 8.5in; --page-h: 11in; }
    /* Always give html/body a white background so canvases aren't transparent */
    html, body { background:#ffffff; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    /* Keep containers fully sized/painted (iOS fix for 0px width captures) */
    #proposal-container, #proposal-content {
      background:#ffffff !important;
      width:100% !important;
      min-height:auto !important;
      color:#111827;
    }
    #proposal-content { max-width:820px; margin:0 auto; }

    /* Typography */
    #proposal-content h1 { font-size:2rem; font-weight:700; margin:0 0 1rem; }
    #proposal-content h2 { font-size:1.5rem; font-weight:700; margin:1.6rem 0 .9rem; }
    #proposal-content h3 { font-size:1.15rem; font-weight:600; margin:1.1rem 0 .5rem; }
    #proposal-content p, #proposal-content li { font-size:1rem; line-height:1.65; margin-bottom:.7rem; }
    #proposal-content ul { list-style:disc; padding-left:1.4rem; }

    /* Fill the page cleanly: avoid splitting common blocks */
    h2, h3, p, ul, figure { page-break-inside: avoid; }

    /* Appendix visuals */
    .appendix-item { margin:.5rem 0 1.2rem; }
    .appendix-item img{
      max-width:100%; height:auto;
      border:1px solid #e5e7eb; border-radius:.5rem;
      margin:.4rem 0 .6rem;
      max-height: calc(var(--page-h) - 1.6in);
      object-fit: contain;
    }
    .appendix-item figcaption{ font-size:.9rem; color:#4b5563; text-align:center; margin-bottom:.8rem; }

    /* Page-break helpers honored by html2pdf (pagebreak.mode=['css','legacy']) */
    .pb { page-break-before: always; }          /* targeted page start */
    .pdf-avoid { page-break-inside: avoid; }    /* keep together */

    /* Button spinner */
    .spinner{ border:4px solid rgba(0,0,0,.1); width:20px; height:20px; border-radius:50%;
              border-left-color:#ffffff; animation:spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body class="flex flex-col items-center min-h-screen p-4 sm:p-8">

  <!-- Toolbar -->
  <div class="w-full max-w-4xl bg-white rounded-lg shadow-lg p-6 mb-8 sticky top-4 z-10">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
      <div>
        <h1 class="text-2xl font-bold text-gray-800">Business Proposal PDF Generator</h1>
        <p class="text-gray-600 mt-1">Preview below, then download the PDF.</p>
      </div>
      <button id="download-btn" class="w-full sm:w-auto flex items-center gap-3 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow hover:bg-blue-700">
        <span id="btn-text">Download PDF</span>
        <div id="spinner" class="spinner hidden"></div>
      </button>
    </div>
  </div>

  <!-- Content -->
  <div id="proposal-container" class="w-full max-w-4xl bg-white rounded-lg shadow-lg p-8 sm:p-12">
    <div id="proposal-content"></div>
  </div>

  <script>
    /* ------------------ FULL BUSINESS CONTENT ------------------ */
    const markdownContent = `
# Proposal: Implementing the Vehicle Clearance Management System

## Executive Summary
This proposal outlines the implementation of a new **Vehicle Clearance Management System**, a robust digital solution designed to modernize and streamline vehicle access control. The system, born from a deep understanding of real-world operational challenges, offers significant improvements over traditional manual processes. It will enhance security through multi-factor authentication, increase operational efficiency via real-time data synchronization, and provide a clear, auditable record of all vehicle movements. This system presents a compelling opportunity to not only optimize internal operations but also to generate a new revenue stream through a Software-as-a-Service (SaaS) model for external clients.

---

## 1. The Inspiration: From Insight to Innovation
The inspiration for this system came from a recent meeting with the OC (Officer-in-Charge) of PCC. The initial idea was to create a simple system to manage our internal incoming vehicles and address operational inefficiencies. However, a key turning point came from the OC’s valuable feedback, which highlighted the specific limitations and roadblocks within the Singapore Police Force (SPF) operations. This insight allowed us to move beyond a simple internal tool and develop a solution that directly addresses the real-world pain points faced by security and administrative personnel. By understanding these challenges firsthand, we can now provide a superior service that truly meets our clients' needs.

---

## 2. Our Solution: The Vehicle Clearance Management System
The Vehicle Clearance Management System is a comprehensive, web-based platform that addresses the limitations of manual systems. It leverages modern technology to provide a seamless, secure, and efficient experience. The system's clean, user-centric design ensures ease of use for all stakeholders, from administrators to on-ground personnel **(See Appendix A)**.

### Key Features and Technical Specifications:
* **Real-Time Tracking and Management:** The system provides an "Admin Dashboard" for real-time management of vehicle clearances and pending requests. Administrators can easily review, approve, or reject clearance requests from a centralized interface **(See Appendix B)**. All data is synchronized in real-time across all connected devices, ensuring that on-ground personnel have the most up-to-date information **(See Appendix C)**.
* **Enhanced Security and Access Control:** The system incorporates a "Secure Access" feature that validates user IDs and verifies a user's physical location against a list of authorized geofenced locations before granting access **(See Appendix D)**. This is achieved using the browser's Geolocation API, providing a precise and secure method of location verification.
* **Intuitive User Interface:** The "Request Clearance" feature allows external users to easily submit requests through a simple web form **(See Appendix E)**.
* **Advanced Data and Reporting:** Client-side PDF reports for all vehicle clearances and requests over a 24-hour period.
* **Voice-Enabled Search:** Powered by the **Web Speech API** for quick, hands-free lookups.
* **Reliability & Scalability:** Hosted on **Google Firebase** with admin tooling **(See Appendix F & G)**.

---

## 3. Revenue Model
We propose a multi-tier SaaS model:
- **Tier 1 – Basic:** Core clearance management, request tracking, basic reporting.
- **Tier 2 – Professional:** Adds secure access (ID + location validation) and an expanded VVIP list.
- **Tier 3 – Enterprise:** Adds database management (backup/export/reset), custom reporting, priority support. Pricing is bespoke.

---

## 4. Competitive Advantage
Ease-of-use + robust security + voice and geolocation features not common in off-the-shelf tools; cloud architecture enables fast onboarding and scale.

---

## 5. Implementation Plan
* **Phase 1 (30 days):** Internal deployment/pilot to capture feedback.
* **Phase 2 (30–60 days):** Finalize product, marketing assets, pricing tiers.
* **Phase 3 (90 days):** Targeted launch to selected segments.

---

## 6. Financial Projections
(For internal use—add costs, projected revenue growth, break-even analysis.)

---

## 7. Conclusion
This system is both an operational upgrade and a strategic revenue opportunity, enabling us to serve internal needs and external clients with a scalable SaaS.
`;

    /* ------------------ APPENDIX IMAGES & LOADER ------------------ */
    const RAW_BASE = "https://raw.githubusercontent.com/theva73/Business-Proposal/main/";
    const appendixItems = [
      { file: "Landing page.jpg", caption: "Main landing page." },
      { file: "Admin Dashboard.jpg", caption: "Admin Dashboard overview." },
      { file: "Daily  Clearances page.jpg", caption: "Green List with voice search (double space after 'Daily')." },
      { file: "Secure Access login.jpg", caption: "Geofenced Secure Access login." },
      { file: "Request Vehicle Clearance Form.jpg", caption: "Public request form." },
      { file: "Access Control setting.jpg", caption: "Access control settings." },
      { file: "Database management .jpg", caption: "Database management tools (space before .jpg)." }
    ];

    // Build filename variants to survive tiny renames (spaces/underscores/dashes)
    function variants(file){
      const v = new Set();
      v.add(file);
      v.add(file.replace(/\s{2,}/g,' '));
      v.add(file.replace(/\s+/g,'_'));
      v.add(file.replace(/\s+/g,'-'));
      return Array.from(v);
    }
    function loadWithFallback(imgEl, filename){
      const cands = variants(filename).map(f => RAW_BASE + encodeURIComponent(f));
      let i = 0;
      const tryNext = () => {
        if(i >= cands.length){
          imgEl.outerHTML = '<div class="text-sm text-red-600 p-3 border border-red-200 rounded">Image failed to load: '+filename+'</div>';
          return;
        }
        imgEl.onerror = () => { i++; tryNext(); };
        imgEl.crossOrigin = 'anonymous';
        imgEl.src = cands[i];
      };
      tryNext();
    }

    /* ------------------ RENDER ------------------ */
    document.addEventListener('DOMContentLoaded', () => {
      const root = document.getElementById('proposal-content');

      // Convert markdown → HTML
      const md = new showdown.Converter();
      let html = md.makeHtml(markdownContent);
      root.innerHTML = html;

      // Targeted breaks: start "Our Solution" & "Implementation Plan" on new pages
      const h2s = Array.from(root.querySelectorAll('h2'));
      h2s.forEach(h => {
        const t = h.textContent.trim().toLowerCase();
        if (t.startsWith('2. our solution') || t.startsWith('5. implementation plan')) {
          h.classList.add('pb');
        }
      });

      // Build Appendix section
      const appxH2 = document.createElement('h2');
      appxH2.textContent = 'Appendix';
      appxH2.className = 'pb';
      root.appendChild(appxH2);

      appendixItems.forEach((item, idx) => {
        const letter = String.fromCharCode(65 + idx);
        const box = document.createElement('div');
        box.className = 'appendix-item pdf-avoid pb';
        box.innerHTML = `
          <h3>Appendix ${letter}</h3>
          <figure>
            <img id="appx-${letter}" alt="Appendix ${letter}">
            <figcaption>${item.caption}</figcaption>
          </figure>`;
        root.appendChild(box);
      });

      // Load the images now that nodes exist
      appendixItems.forEach((item, idx) => {
        const letter = String.fromCharCode(65 + idx);
        loadWithFallback(document.getElementById(`appx-${letter}`), item.file);
      });

      /* ------------------ DOWNLOAD HANDLER ------------------ */
      const downloadBtn = document.getElementById('download-btn');
      const spinner = document.getElementById('spinner');
      const btnText = document.getElementById('btn-text');

      downloadBtn.addEventListener('click', async () => {
        btnText.textContent = 'Generating...';
        spinner.classList.remove('hidden');
        downloadBtn.disabled = true;

        // Wait for all images (load OR error), then one paint frame (iOS whiteout fix)
        const imgs = root.querySelectorAll('img');
        await Promise.all(Array.from(imgs).map(img =>
          img.complete ? Promise.resolve() :
          new Promise(res => { img.onload = res; img.onerror = res; })
        ));
        await new Promise(requestAnimationFrame);

        const opt = {
          /* snug but readable margins */
          margin: [0.6, 0.5, 0.65, 0.5],
          filename: 'Business-Proposal-Vehicle-Clearance-System.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: {
            scale: 2,
            useCORS: true,
            backgroundColor: '#ffffff',   // force solid background
            allowTaint: false,
            logging: false,
            windowWidth: root.scrollWidth,
            windowHeight: root.scrollHeight
          },
          jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
          pagebreak: {
            mode: ['css', 'legacy'],
            avoid: 'p, h2, h3, ul, figure, .pdf-avoid'
          }
        };

        try {
          await html2pdf().set(opt).from(root).save();
        } finally {
          btnText.textContent = 'Download PDF';
          spinner.classList.add('hidden');
          downloadBtn.disabled = false;
        }
      });
    });
  </script>
</body>
</html>
